#!/usr/bin/env bash

# Warmup wl-ime-type to establish Wayland IME connection
# This prevents cold-start issues on first emoji insertion
if ! pgrep -x "wl-ime-type" > /dev/null 2>&1; then
    # Send empty string to initialize connection (xargs converts stdin to args)
    echo -n "" | xargs -n1 wl-ime-type 2>/dev/null || true
    # Brief delay for socket initialization
    sleep 0.1
fi

# Configure bemoji to use wl-ime-type for direct emoji typing
# xargs is REQUIRED to convert stdin (emoji from bemoji) to positional argument
# This avoids clipboard usage and works with Chromium/Brave + Wayland IME flags
export BEMOJI_TYPE_CMD="xargs -n1 wl-ime-type"

# Use custom rofi wrapper that applies left-alignment
export BEMOJI_PICKER_CMD="$HOME/.config/sway/scripts/rofi-emoji-picker"

# Launch bemoji with typing enabled (-t flag)
# Uses custom rofi wrapper (configured above)
# Saves to history for recent emojis
bemoji -t

exit 0
